# BMS系统接口设计文档

## 1. Signal模块接口

### 1.1 创建信号记录

#### 接口概述
- 功能：创建新的信号记录
- 作用：接收并存储车辆发送的信号数据，用于后续监控和分析

#### 请求信息
- 请求方法：POST
- 请求URL：/api/signal
- 请求头：
  - Content-Type: application/json
- 请求体：
```json
{
    "vid": "VH6FTQ5CHDZOEXEI",
    "voltage": 380.5,
    "current": 25.3,
    "timestamp": "2024-01-01T12:00:00"
}
```

#### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "信号记录创建成功",
    "data": {
        "signalId": 1,
        "vid": "VH6FTQ5CHDZOEXEI",
        "voltage": 380.5,
        "current": 25.3,
        "timestamp": "2024-01-01T12:00:00"
    }
}
```

### 1.2 获取单个信号记录

#### 接口概述
- 功能：根据信号ID获取特定的信号记录
- 作用：查询单条信号数据的详细信息

#### 请求信息
- 请求方法：GET
- 请求URL：/api/signal/{signalId}
- 请求参数：
  - signalId：信号记录ID（路径参数）

#### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "信号记录查询成功",
    "data": {
        "signalId": 1,
        "vid": "VH6FTQ5CHDZOEXEI",
        "voltage": 380.5,
        "current": 25.3,
        "timestamp": "2024-01-01T12:00:00"
    }
}
```

### 1.3 获取车辆信号记录列表

#### 接口概述
- 功能：根据车辆ID获取该车辆的所有信号记录
- 作用：查询特定车辆的历史信号数据

#### 请求信息
- 请求方法：GET
- 请求URL：/api/signal/vehicle/{vid}
- 请求参数：
  - vid：车辆ID（路径参数）

#### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "车辆信号记录查询成功",
    "data": [
        {
            "signalId": 1,
            "vid": "VH6FTQ5CHDZOEXEI",
            "voltage": 380.5,
            "current": 25.3,
            "timestamp": "2024-01-01T12:00:00"
        }
    ]
}
```

### 1.4 获取所有信号记录

#### 接口概述
- 功能：获取系统中所有的信号记录
- 作用：用于系统管理员查看所有车辆的信号数据

#### 请求信息
- 请求方法：GET
- 请求URL：/api/signal

#### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "查询所有信号记录成功",
    "data": [
        {
            "signalId": 1,
            "vid": "VH6FTQ5CHDZOEXEI",
            "voltage": 380.5,
            "current": 25.3,
            "timestamp": "2024-01-01T12:00:00"
        }
    ]
}
```

### 1.5 更新信号记录

#### 接口概述
- 功能：更新已存在的信号记录
- 作用：修正或更新已记录的信号数据

#### 请求信息
- 请求方法：PUT
- 请求URL：/api/signal/{signalId}
- 请求头：
  - Content-Type: application/json
- 请求体：
```json
{
    "voltage": 385.5,
    "current": 26.3,
    "timestamp": "2024-01-01T12:00:00"
}
```

#### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "信号记录更新成功",
    "data": {
        "signalId": 1,
        "vid": "VH6FTQ5CHDZOEXEI",
        "voltage": 385.5,
        "current": 26.3,
        "timestamp": "2024-01-01T12:00:00"
    }
}
```

### 1.6 删除信号记录

#### 接口概述
- 功能：删除特定的信号记录
- 作用：清理无效或错误的信号数据

#### 请求信息
- 请求方法：DELETE
- 请求URL：/api/signal/{signalId}
- 请求参数：
  - signalId：信号记录ID（路径参数）

#### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "信号记录删除成功"
}
```

### 1.7 删除车辆所有信号记录

#### 接口概述
- 功能：删除指定车辆的所有信号记录
- 作用：批量清理特定车辆的历史数据

#### 请求信息
- 请求方法：DELETE
- 请求URL：/api/signal/vehicle/{vid}
- 请求参数：
  - vid：车辆ID（路径参数）

#### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "车辆信号记录删除成功"
}
```

### 1.8 检查信号记录是否存在

#### 接口概述
- 功能：检查特定ID的信号记录是否存在
- 作用：验证信号记录的存在性

#### 请求信息
- 请求方法：GET
- 请求URL：/api/signal/{signalId}/exists
- 请求参数：
  - signalId：信号记录ID（路径参数）

#### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "检查信号记录存在状态成功",
    "data": true
}
```

## 2. Warn模块接口

### 2.1 接收警告信息

#### 接口概述
- 功能：接收并处理批量警告信息
- 作用：处理系统检测到的异常信号，生成警告记录

#### 请求信息
- 请求方法：POST
- 请求URL：/api/warn
- 请求头：
  - Content-Type: application/json
- 请求体：
```json
[
    {
        "vid": "VH6FTQ5CHDZOEXEI",
        "warnType": "VOLTAGE_HIGH",
        "warnValue": 430.5,
        "timestamp": "2024-01-01T12:00:00"
    }
]
```

#### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "status": 200,
    "msg": "ok",
    "data": [
        {
            "warnId": 1,
            "vid": "VH6FTQ5CHDZOEXEI",
            "warnType": "VOLTAGE_HIGH",
            "warnValue": 430.5,
            "timestamp": "2024-01-01T12:00:00",
            "status": "PROCESSED"
        }
    ]
}
```

### 2.2 查询车辆预警信息

#### 接口概述
- 功能：获取指定车辆的所有预警信息
- 作用：查询特定车辆的历史预警记录

#### 请求信息
- 请求方法：GET
- 请求URL：/api/warn/vehicle/{carId}
- 请求参数：
  - carId：车辆ID（路径参数）

#### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "code": 200,
    "msg": "success",
    "data": [
        {
            "warnId": 1,
            "vid": "VH6FTQ5CHDZOEXEI",
            "warnType": "VOLTAGE_HIGH",
            "warnValue": 430.5,
            "timestamp": "2024-01-01T12:00:00",
            "status": "PROCESSED"
        }
    ]
}
```

## 3. BMS核心模块接口

### 3.1 电池类型管理接口

#### 3.1.1 创建电池类型

##### 接口概述
- 功能：创建新的电池类型
- 作用：在系统中添加新的电池类型定义

##### 请求信息
- 请求方法：POST
- 请求URL：/api/bat/type
- 请求头：
  - Content-Type: application/json
- 请求体：
```json
{
    "typeName": "三元电池"
}
```

##### 响应信息
- 成功响应：
  - 状态码：201 Created
  - 响应体：
```json
{
    "id": 1,
    "typeName": "三元电池",
    "deleted": false
}
```

#### 3.1.2 获取电池类型

##### 接口概述
- 功能：根据ID获取电池类型信息
- 作用：查询特定电池类型的详细信息

##### 请求信息
- 请求方法：GET
- 请求URL：/api/bat/type/{id}
- 请求参数：
  - id：电池类型ID（路径参数）

##### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "id": 1,
    "typeName": "三元电池",
    "deleted": false
}
```

#### 3.1.3 获取所有电池类型

##### 接口概述
- 功能：获取所有未删除的电池类型
- 作用：查询系统中所有可用的电池类型

##### 请求信息
- 请求方法：GET
- 请求URL：/api/bat/types

##### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
[
    {
        "id": 1,
        "typeName": "三元电池",
        "deleted": false
    },
    {
        "id": 2,
        "typeName": "铁锂电池",
        "deleted": false
    }
]
```

#### 3.1.4 更新电池类型

##### 接口概述
- 功能：更新电池类型信息
- 作用：修改已存在的电池类型信息

##### 请求信息
- 请求方法：PUT
- 请求URL：/api/bat/type/{id}
- 请求头：
  - Content-Type: application/json
- 请求体：
```json
{
    "typeName": "新型三元电池"
}
```

##### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "id": 1,
    "typeName": "新型三元电池",
    "deleted": false
}
```

#### 3.1.5 删除电池类型

##### 接口概述
- 功能：软删除电池类型
- 作用：将电池类型标记为已删除状态

##### 请求信息
- 请求方法：DELETE
- 请求URL：/api/bat/type/{id}
- 请求参数：
  - id：电池类型ID（路径参数）

##### 响应信息
- 成功响应：
  - 状态码：204 No Content

### 3.2 告警规则管理接口

#### 3.2.1 创建告警规则

##### 接口概述
- 功能：创建新的告警规则
- 作用：设置电池监控的告警条件和阈值

##### 请求信息
- 请求方法：POST
- 请求URL：/api/rule
- 请求头：
  - Content-Type: application/json
- 请求体：
```json
{
    "batteryTypeId": 1,
    "ruleName": "电压过高告警",
    "ruleType": "VOLTAGE_HIGH",
    "threshold": 4.2,
    "description": "电池电压超过4.2V时触发告警"
}
```

##### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "告警规则创建成功",
    "data": {
        "ruleId": 1,
        "batteryTypeId": 1,
        "ruleName": "电压过高告警",
        "ruleType": "VOLTAGE_HIGH",
        "threshold": 4.2,
        "description": "电池电压超过4.2V时触发告警",
        "deleted": false
    }
}
```

#### 3.2.2 更新告警规则

##### 接口概述
- 功能：更新已存在的告警规则
- 作用：修改告警规则的阈值或其他属性

##### 请求信息
- 请求方法：PUT
- 请求URL：/api/rule/{ruleId}
- 请求头：
  - Content-Type: application/json
- 请求体：
```json
{
    "ruleName": "电压过高告警",
    "threshold": 4.3,
    "description": "电池电压超过4.3V时触发告警"
}
```

##### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "告警规则更新成功",
    "data": {
        "ruleId": 1,
        "batteryTypeId": 1,
        "ruleName": "电压过高告警",
        "ruleType": "VOLTAGE_HIGH",
        "threshold": 4.3,
        "description": "电池电压超过4.3V时触发告警",
        "deleted": false
    }
}
```

#### 3.2.3 获取告警规则

##### 接口概述
- 功能：根据ID获取告警规则
- 作用：查询特定告警规则的详细信息

##### 请求信息
- 请求方法：GET
- 请求URL：/api/rule/{ruleId}
- 请求参数：
  - ruleId：规则ID（路径参数）

##### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "告警规则查询成功",
    "data": {
        "ruleId": 1,
        "batteryTypeId": 1,
        "ruleName": "电压过高告警",
        "ruleType": "VOLTAGE_HIGH",
        "threshold": 4.2,
        "description": "电池电压超过4.2V时触发告警",
        "deleted": false
    }
}
```

#### 3.2.4 获取所有告警规则

##### 接口概述
- 功能：获取所有未删除的告警规则
- 作用：查询系统中所有可用的告警规则

##### 请求信息
- 请求方法：GET
- 请求URL：/api/rule

##### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "查询所有告警规则成功",
    "data": [
        {
            "ruleId": 1,
            "batteryTypeId": 1,
            "ruleName": "电压过高告警",
            "ruleType": "VOLTAGE_HIGH",
            "threshold": 4.2,
            "description": "电池电压超过4.2V时触发告警",
            "deleted": false
        }
    ]
}
```

### 3.3 车辆管理接口

#### 3.3.1 创建车辆

##### 接口概述
- 功能：创建新车辆记录
- 作用：在系统中添加新的车辆信息

##### 请求信息
- 请求方法：POST
- 请求URL：/api/vehicle
- 请求头：
  - Content-Type: application/json
- 请求体：
```json
{
    "carId": 100,
    "batteryTypeId": 1,
    "manufacturer": "小米汽车",
    "model": "MS1"
}
```

##### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "车辆创建成功",
    "data": {
        "vid": "VH6FTQ5CHDZOEXEI",
        "carId": 100,
        "batteryTypeId": 1,
        "manufacturer": "小米汽车",
        "model": "MS1",
        "deleted": false
    }
}
```

#### 3.3.2 根据VID获取车辆

##### 接口概述
- 功能：根据车辆唯一标识符查询车辆信息
- 作用：获取特定车辆的详细信息

##### 请求信息
- 请求方法：GET
- 请求URL：/api/vehicle/{vid}
- 请求参数：
  - vid：车辆VID（路径参数）

##### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "车辆查询成功",
    "data": {
        "vid": "VH6FTQ5CHDZOEXEI",
        "carId": 100,
        "batteryTypeId": 1,
        "manufacturer": "小米汽车",
        "model": "MS1",
        "deleted": false
    }
}
```

#### 3.3.3 根据车架号获取车辆

##### 接口概述
- 功能：根据车架号查询车辆信息
- 作用：获取特定车辆的详细信息

##### 请求信息
- 请求方法：GET
- 请求URL：/api/vehicle/car/{carId}
- 请求参数：
  - carId：车架号（路径参数）

##### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "车辆查询成功",
    "data": {
        "vid": "VH6FTQ5CHDZOEXEI",
        "carId": 100,
        "batteryTypeId": 1,
        "manufacturer": "小米汽车",
        "model": "MS1",
        "deleted": false
    }
}
```

#### 3.3.4 获取所有车辆

##### 接口概述
- 功能：获取所有未删除的车辆信息
- 作用：查询系统中所有可用的车辆

##### 请求信息
- 请求方法：GET
- 请求URL：/api/vehicle

##### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "查询所有车辆成功",
    "data": [
        {
            "vid": "VH6FTQ5CHDZOEXEI",
            "carId": 100,
            "batteryTypeId": 1,
            "manufacturer": "小米汽车",
            "model": "MS1",
            "deleted": false
        }
    ]
}
```

#### 3.3.5 更新车辆信息

##### 接口概述
- 功能：更新车辆信息
- 作用：修改已存在的车辆信息

##### 请求信息
- 请求方法：PUT
- 请求URL：/api/vehicle/{vid}
- 请求头：
  - Content-Type: application/json
- 请求体：
```json
{
    "manufacturer": "小米汽车",
    "model": "MS2"
}
```

##### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "车辆信息更新成功",
    "data": {
        "vid": "VH6FTQ5CHDZOEXEI",
        "carId": 100,
        "batteryTypeId": 1,
        "manufacturer": "小米汽车",
        "model": "MS2",
        "deleted": false
    }
}
```

#### 3.3.6 删除车辆

##### 接口概述
- 功能：软删除车辆信息
- 作用：将车辆标记为已删除状态

##### 请求信息
- 请求方法：DELETE
- 请求URL：/api/vehicle/{vid}
- 请求参数：
  - vid：车辆VID（路径参数）

##### 响应信息
- 成功响应：
  - 状态码：200 OK
  - 响应体：
```json
{
    "message": "车辆删除成功"
}
```
