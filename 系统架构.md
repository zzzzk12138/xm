# 技术方案设计

## 系统设计

### 明确身份/模块

首先，根据身份不同，可以分为三个主要角色：车主/车辆，工程师，电池专家。

电池专家部分，主要负责电池基本信息的管理，电池信息的创建，电池规则的创建。

车主/车辆部分，主要负责基本数据的创建，包括基础车辆信息的创建。

工程师部分，负责解决具体的需求，例如预警信息的处理等。

### 明确具体业务需求：

可将电池专家部分和车主/车辆部分看成一个**基础模块**，由我们手动去进行**基础数据/规则的上传**。

工程师部分，可根据项目的具体需求（**信号模块**和**预警模块**），拆分成两个模块，单独负责**信号的处理**和**预警的处理**。



**基础模块**：负责基础数据，例如电池，车辆，预警规则的处理（增删改查）

**信号模块-关键**：负责电池信号的上报与存储，在这里需要注意mysql和redis缓存的一致性。定时向MQ中发送具体信号数据。同时在另一个MQ中接收预警模块的上报，处理待消费（满足预警规则）的信号。

**预警模块-关键**：负责处理具体电池信号数据，支持通过制定接口查询制定车辆的预警信息。消费MQ中的信号数据，结合预警规则约束，上报预警信息。同时将需要处理的信号通过另一个MQ发送给信号模块去进行预警的信号消费。



架构图如下：

![xm.drawio (../../学习记录/大作业-技术方案.assets/xm.drawio (2).png)](大作业-技术方案.assets/xm.drawio (2).png)



其中有两个MQ

一个的topic为“**SignalTopic**”

​	由信号模块作为提供者，定时从表中获取未处理过的signal信号，发送给预警模块。

​	预警模块作为消费者，结合预警规则，分析具体信号是否产生预警信息，同时进行预警信息的上报存储。

一个的topic为“**SignalStatusTopic**”

​	由预警模块作为消息提供者，在分析一个批次的信号是否产生预警时，收集所有产生预警的信号，发送给信号模块具体处理

​	由信号模块作为消费者，收到需要处理的信号后，进行具体信号的消费处理，下次再扫描时会跳过已处理的信号。



### 项目结构

```
BMS/
├── signal/                        # 信号处理模块
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/
│   │   │   │   └── com/xiaomi/signal/
│   │   │   │       ├── config/                   # 配置类
│   │   │   │       ├── controller/               # 控制器
│   │   │   │       ├── entity/                   # 实体类
│   │   │   │       ├── mapper/                   # MyBatis映射器
│   │   │   │       ├── service/                  # 服务层
│   │   │   │       ├── task/                     # 定时任务
│   │   │   │       └── SignalApplication.java    # 信号模块启动类
│   │   │   └── resources/                        # 资源文件目录
│   │   └── test/                                 # 测试代码目录
│   └── pom.xml                                   # 信号模块依赖管理
│
├── warn/                          # 警告处理模块
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/
│   │   │   │   └── com/xiaomi/warn/
│   │   │   │       ├── config/                   # 配置类
│   │   │   │       ├── controller/               # 控制器
│   │   │   │       ├── dto/                      # 数据传输对象
│   │   │   │       ├── entity/                   # 实体类
│   │   │   │       ├── mapper/                   # MyBatis映射器
│   │   │   │       ├── processor/                # 信号处理器
│   │   │   │       ├── service/                  # 服务层
│   │   │   │       ├── task/                     # 定时任务
│   │   │   │       ├── utils/                    # 工具类
│   │   │   │       └── WarnApplication.java      # 告警模块启动类
│   │   │   └── resources/                        # 资源文件目录
│   │   └── test/                                 # 测试代码目录
│   └── pom.xml                                   # 告警模块依赖管理
│
├── src/                          # 主模块
│   ├── main/
│   │   ├── java/
│   │   │   └── com/xiaomi/bms/
│   │   │       ├── config/                       # 配置类
│   │   │       ├── controller/                   # 控制器
│   │   │       ├── dto/                          # 数据传输对象
│   │   │       ├── entity/                       # 实体类
│   │   │       ├── mapper/                       # MyBatis映射器
│   │   │       ├── mq/                           # 消息队列
│   │   │       ├── service/                      # 服务层
│   │   │       ├── utils/                        # 工具类
│   │   │       └── BmsApplication.java           # 主应用启动类
│   │   └── resources/                            # 资源文件目录
│   └── test/                                     # 测试代码目录
│
└── pom.xml                       # 项目依赖管理
```

